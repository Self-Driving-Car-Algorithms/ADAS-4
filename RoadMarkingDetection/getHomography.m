%Function to estimate homography from point correspondencies
function [H] = getHomography(p1, p2)
    %Generate A matrix
    A(1,:) = [p1(1,1), p1(1,2), 1, 0, 0, 0, -p2(1,1)*p1(1,1), -p2(1,1)*p1(1,2)];
    A(2,:) = [0, 0, 0, p1(1,1), p1(1,2), 1, -p2(1,2)*p1(1,1), -p2(1,2)*p1(1,2)];
    A(3,:) = [p1(2,1), p1(2,2), 1, 0, 0, 0, -p2(2,1)*p1(2,1), -p2(2,1)*p1(2,2)];
    A(4,:) = [0, 0, 0, p1(2,1), p1(2,2), 1, -p2(2,2)*p1(2,1), -p2(2,2)*p1(2,2)];
    A(5,:) = [p1(3,1), p1(3,2), 1, 0, 0, 0, -p2(3,1)*p1(3,1), -p2(3,1)*p1(3,2)];
    A(6,:) = [0, 0, 0, p1(3,1), p1(3,2), 1, -p2(3,2)*p1(3,1), -p2(3,2)*p1(3,2)];
    A(7,:) = [p1(4,1), p1(4,2), 1, 0, 0, 0, -p2(4,1)*p1(4,1), -p2(4,1)*p1(4,2)];
    A(8,:) = [0, 0, 0, p1(4,1), p1(4,2), 1, -p2(4,2)*p1(4,1), -p2(4,2)*p1(4,2)];
    
    %Generate B matrix
    B(1,1) = p2(1,1);
    B(2,1) = p2(1,2);
    B(3,1) = p2(2,1);
    B(4,1) = p2(2,2);
    B(5,1) = p2(3,1);
    B(6,1) = p2(3,2);
    B(7,1) = p2(4,1);
    B(8,1) = p2(4,2);
    
    %A\B is same as inv(A)*b
    H = inv(A) * B;
    % Add a element to make H 9x1 matrix so that it can be reshaped
    H(9,1) = 1;
    H = (reshape(H,3,3))';
end